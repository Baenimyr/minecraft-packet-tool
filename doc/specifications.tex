\documentclass{article}
\usepackage{inputenc}
\usepackage[T1]{fontenc}
\usepackage[margin=25mm]{geometry}
\usepackage[french]{babel}

\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{dirtree}

\setitemize{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}

\title{Document de spécification pour le projet ForgeMods}

\begin{document}
\maketitle
\tableofcontents

\section{Description du projet}
MinecraftForge est le système de mod autour de minecraft le plus utilisé au monde.
La communauté est très grande et le développement produit une très grande quantité de mods.

Plus particulièrement, au moment de rejoindre un serveur moddé, certains peuvent manquer et les dépendances des mods entre eux n'est pas évidente à résoudre.
Il faut attendre le lancement du jeu pour ce rendre compte qu'il en manque un, et ensuite la dépendance de la dépendance.

L'objectif est un programme en ligne de commande capable de télécharger n'importe quel mod (suffisamment connu) dans le dossier de son choix en quelques secondes.
Le système Linux, propose des gestionnaire de paquets capable également de résoudre les dépendances au moment de l'installation, ainsi rien ne manque.


\section{Fonctionnalités}
Les fonctionnalités suivantes sont présentées dans l'ordre de complexité et l'ordre de réalisation.

\subsection{Analyse de l'installation}
Il s'agit ici de lire les fichiers \texttt{jar} présent dans le répertoire d'installation et d'en extraire des données.
Ensuite le système peut vérifier l'arbre des dépendances et informer l'utilisateur de l'absence d'un mod particulier.

Une fois les informations extraites, le programme peut afficher les informations, afficher l'arbre de dépendance, faire des estimations de ram nécessaire au lancement du jeu.
MinecraftForge est déjà capable de vérifier les mises à jour et ce programme pourrait également le faire.


\subsection{Téléchargement des fichiers}
Une fois un mod demandé ou requis par les autres, le programme doit pouvoir trouver le fichier correspondant sur internet.
Pour un identifiant de mod et une version, il faut maintenant fournir l'url de téléchargement (par exemple directement les sites hébergeurs).
Les versions disponibles peuvent être limitées aux versions stables.

\subsubsection{Dépôt local des informations}
\label{section:depot_local}
Sans connexion internet, le programme doit pouvoir fournir les informations détaillées glanées sur internet et concernant les mods couremment installés.
Il est inutile de s'encombrer des informations non nécessaires.
Les informations locales peuvent être mises à jour sur demande ou automatiquement de temps en temps.

\subsubsection{Dépot internet de informations complètes}
Malheureusement trop souvent, les informations des fichiers \textit{mcmod.info} sont mal renseignées et les vrais données sont fournies à \textit{@Mod} dans le code.
Cette source d'information est inaccessible.
S'ajoute à cela les informations comme le lien de téléchargement qui ne sont pas fournies dans le fichier jar.
L'ensemble des informations vérifiées devront donc être disponibles en ligne, et localement en cache.

Une base de données en ligne pose des problèmes de complexité de lecture et de mise en place.
En s'inspirant des paquets Linux toujours, le téléchargement de fichiers individuels dans une arborescence structurée est plus adéquate.
Un premier fichier texte compressé, recense les mods disponibles dans un dépôt (voir \texttt{Packages.xz}).
Pour un mod et une version connue, correspond un emplacement dans l'arbre des arborescence.
Un système basé sur les dépôt permet aux groupes de développeurs de gérer leur propre dépôt.
L'utilisation d'un dossier intermédiaire avec la première lettre du modid permet une gestion mémoire physique plus souple sur les grands dépôts.

\dirtree{%
.1 /.
.2 Mods.json.
.2 pool.
.3 a.
.4 aether.
.5 aether.json.
.5 aether\_legacy-1.12.2-v1.4.4.
.4 appliedenergistics.
.5 appliedenergistics.json.
.5 Applied-Energistics-2-Mod-1.12.2.
.5 ...
.3 c.
.4 cofhcore.
.5 cofhcore.json.
}

Mods.json (\ref{figure:mods.json}) contient la liste des modid proposés et les informations générales, indépendantes des versions.
Les champs obligatoires sont \textit{modid} et \textit{name}.

Pour un modid donnée, \textit{modid}.json (\ref{figure:modid.json}) contient la liste de toutes les versions connues et leurs informations particulières.
Notamment, pour chaque version si un lien de téléchargement est donné, il peut pointer vers le dépôt lui-même ou un site de téléchargement.
Les informations que l'on peut y trouver sont:
\begin{itemize}
    \item mcversion: \textbf{obligatoire}
    \item requiredMods: liste des mods et leurs versions requis pour le bon fonctionnement de celui-ci
    \item dependencies: liste de mods non obligatoires mais recommandés.
    \item dependants: liste de mods qui pourrait utiliser celui-ci.
    \item file: url pour récupérer le fichier
    \item alias: peut servir à identifier les mods grâce à leur nom de fichier, dans le cas d'un \textit{mcmod.info}.
\end{itemize}

\begin{figure}
\centering
\begin{verbatim}
[
    "<modid>"{
        "name": <name>,
        "description": <description>,
        "url": <url>,
        "updateJSON": <url>
    },
    "cofhcore": {
        "name": "Thermal Expansion"
    }
]
\end{verbatim}
\caption{Fichier Mods.json}
\label{figure:mods.json}
\end{figure}

\begin{figure}
\begin{verbatim}
{
    "<modversion>": {
        "mcversion": <mcversion>
        "file": "<file url>",
        "requiredMods": [],
        "dependencies": [],
        "dependants": []
    }
}
\end{verbatim}
\caption{Fichier \textit{modid}.json}
\label{figure:modid.json}
\end{figure}


\subsection{Analyse des demandes pour serveur sous MinecraftForge}
Les serveurs MinecraftForge transmettent la liste des mods requis lors des opérations de salutations (nom, nombre de joueurs, \dots).
Avec une adresse de serveur fournies, le programme peut vérifier la disponibilité des mods et proposer d'en télécharger.



\section{Fichiers locaux}
L'instance de jeu utilisée dépend du lieu de lancement du programme ou des options passées en paramètres.
Par défaut, le programme remonte jusqu'au dossier \textit{.minecraft} le plus proche.
S'il n'est existe pas parmis les parents, tente d'utiliser le répertoire par défaut: \textit{.minecraft} sur Linux, ou \textit{AppData/.minecraft} sur windows.

Les informations sauvegardées localement comme décris au paragraphe \ref{section:depot_local} sont placées par défaut dans le répertoire \textit{.minecraft/forgemods}.
Ce répertoire sert de dépôt local et se présente sous la même forme qu'un dépôt en ligne pour simplifier l'importation des données.
Les informations du dépôt local sont toujours utilisées en premier, mais peuvent être mises à jour par les autres dépôts connus.
Si l'utilisateur le permet, un dépôt généralisé peut sauvegarder les fichiers originaux qui ont un jour été téléchargés ou détectés pour les mettre à disposition.


\section{Commandes}
Paramètres génériques:
\begin{itemize}
    \item \texttt{----minecraft}: dossier d'installation minecraft (\$USER\_HOME/.minecraft)
    \item \texttt{----depot}: dossier de dépot local (\$USER\_HOME/.minecraft/forgemods)
\end{itemize}

\medskip
Description de commandes utiles:
\begin{itemize}
    \item \texttt{show mods [regex] [--v] [----all] [----installes]} affiche les mods connus: dans l'installation, et/ou dans le dépot.
L'option --v permet d'afficher toutes les informations connues (ne pas combiner avec \texttt{----all}).
    \item \texttt{show dependences [----absents]}: affiche la liste des dépendances pour les mods dans l'installation minecraft, ou seulement les absents.
    \item \texttt{update}: met à jour le dépot local grâce aux dépots distants.
    \item \texttt{install modid}: installe un nouveau mod grâce aux informations dans le dépot local.
    \item \texttt{uninstall modid}: désinstalle un mod. Ne fait pas la différence entre les mods installés manuellement et les installations automatiques.
    \item \texttt{depot import [modid] [----all]}: importe les informations extraites des mods dans l'installation vers le dépot local.
Necessite une installation minecraft.
    \item \texttt{depot udpate}: similaire à \texttt{update}
    \item \texttt{depot get modid[@version] cle}: affiche la valeur d'une information dans le système de dépot local.
    \item \texttt{depot set modid[@version] cle valeur}: modifie les informations dans le dépot local. Si la version n'est pas spécifiée, les clés sont limités aux données globales du mod.
\end{itemize}


\end{document}